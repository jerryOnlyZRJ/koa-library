{% extends './layout.html' %}
{% block title %}Update{% endblock %}
{% block content %}
<div class="country-create">
    <h1>Create Book</h1>
    <div class="country-form">
        {% for item in fields %}
        <div class="form-group field-country-code required">
            <label class="control-label" for="country-code">{{ item }}</label>
            <input type="text" id="country-code" class="form-control" name="{{ item }}" aria-required="true">
            <div class="help-block"></div>
        </div>
        {% endfor %}
        <div class="form-group">
            <button type="submit" class="btn btn-success">Save</button> </div>
    </div>
</div>
{% endblock %}
{% block scripts %}
<script src="/scripts/yii.validation.js"></script>
<script src="/scripts/yii.activeForm.js"></script>
<script>
    jQuery(function ($) {
        jQuery('#w0').yiiActiveForm([{
            "id": "country-code",
            "name": "code",
            "container": ".field-country-code",
            "input": "#country-code",
            "validate": function (attribute, value, messages, deferred, $form) {
                yii.validation.required(value, messages, {
                    "message": "Code cannot be blank."
                });
                yii.validation.string(value, messages, {
                    "message": "Code must be a string.",
                    "max": 2,
                    "tooLong": "Code should contain at most 2 characters.",
                    "skipOnEmpty": 1
                });
            }
        }, {
            "id": "country-name",
            "name": "name",
            "container": ".field-country-name",
            "input": "#country-name",
            "validate": function (attribute, value, messages, deferred, $form) {
                yii.validation.required(value, messages, {
                    "message": "Name cannot be blank."
                });
                yii.validation.string(value, messages, {
                    "message": "Name must be a string.",
                    "max": 52,
                    "tooLong": "Name should contain at most 52 characters.",
                    "skipOnEmpty": 1
                });
            }
        }, {
            "id": "country-population",
            "name": "population",
            "container": ".field-country-population",
            "input": "#country-population",
            "validate": function (attribute, value, messages, deferred, $form) {
                yii.validation.number(value, messages, {
                    "pattern": /^\s*[+-]?\d+\s*$/,
                    "message": "Population must be an integer.",
                    "skipOnEmpty": 1
                });
            }
        }], []);
    });
</script>
<script>
    var inputs = document.querySelectorAll('.form-group input[type="text"]')
    var submitBtn = document.querySelector(".btn.btn-success")
    var clickHandler = debounce(function (e) {
        var data = {}
        inputs.forEach(function (item) {
            data[item.name] = item.value
        })
        fetch('/api/create', {
            method: 'POST',
            headers: new Headers({
                'Content-Type': 'application/json' // 指定提交方式为表单提交
            }),
            body: JSON.stringify(data)
        }).then(res => {
            location.href = '/'
        }).catch(console.log)
    })
    submitBtn.addEventListener('click', clickHandler)
</script>
{% endblock %}